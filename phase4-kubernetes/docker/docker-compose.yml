# =============================================================================
# Docker Compose Configuration for Todo Application
# Phase IV: Local Multi-Container Testing
# =============================================================================

services:
  # Frontend Service - Next.js Application
  frontend:
    image: todo-frontend:latest
    container_name: todo-frontend
    build:
      context: ../phase2-fullstack-web/frontend
      dockerfile: ../../docker/frontend/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_URL=http://backend:8000
    networks:
      - todo-network
    depends_on:
      - backend
    restart: unless-stopped

  # Backend Service - FastAPI Application
  backend:
    image: todo-backend:latest
    container_name: todo-backend
    build:
      context: ../phase2-fullstack-web/backend
      dockerfile: ../../docker/backend/Dockerfile
    ports:
      - "8000:8000"
    environment:
      # Database Configuration
      - DATABASE_URL=${DATABASE_URL:-postgresql://user:password@localhost:5432/tododb}

      # OpenAI API Configuration
      - OPENAI_API_KEY=${OPENAI_API_KEY:-your-openai-api-key-here}

      # Better Auth Configuration
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET:-your-secret-key-here}
      - BETTER_AUTH_URL=${BETTER_AUTH_URL:-http://localhost:8000}

      # Application Configuration
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000}
    networks:
      - todo-network
    restart: unless-stopped

# Networks
networks:
  todo-network:
    driver: bridge
    name: todo-network

# =============================================================================
# Usage Instructions:
# =============================================================================
#
# 1. Create .env file with required environment variables:
#    DATABASE_URL=postgresql://user:password@host:5432/database
#    OPENAI_API_KEY=sk-...
#    BETTER_AUTH_SECRET=your-secret-key
#
# 2. Build images:
#    docker-compose build
#
# 3. Start services:
#    docker-compose up
#
# 4. Start services in background:
#    docker-compose up -d
#
# 5. View logs:
#    docker-compose logs -f
#
# 6. Stop services:
#    docker-compose down
#
# 7. Rebuild and restart:
#    docker-compose up --build
#
# =============================================================================
